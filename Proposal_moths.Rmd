---
title: "Vegetation drivers of moth assemblages within a tropical agricultural landscape"
author: "Aura Alonso-Rodriguez, Lily Shapiro and Ben Camber"
date: "10/30/2019"
output:
  pdf_document: default
  html_document:
    df_print: paged
---
### Background

Land use change, and specifically agricultural expansion, is recognized globally as one of the major drivers of biodiversity loss. The expansion of African oil palm is specifically threatening, since the tropical areas suitable for oil palm are particularly rich in biodiversity and endemism. There is vast evidence of the severe impacts of oil palm expansion in Southeast Asia, where more than 85% of oil palm is cultivated, mostly by means of primary and secondary forest destruction. Yet due to increasing food and biodiesel demands, oil palm is becoming a major threat in the Neotropics as well. Countries like Costa Rica, Colombia, Guatemala and Brazil, are experiencing increasing land conversion to oil palm, turning previously heterogeneous agricultural matrices into extensive monocultures that support significantly less biodiversity.

The South Pacific region of Costa Rica has grown in oil palm area during the last two decades. Evidence has already shown significant decreases in amphibians, reptiles, bats and insect diversity within these plantations, when compared to adjacent primary forests. In Alonso-Rodriguez et al (2017), moth assemblages were seen to severely degrade in oil palm plantations when compared to primary and young secondary forests. Two moth taxa (Geometridae and Erebidae-Arctiinae, Lepidoptera) showed similar distributions along the disturbance gradient, which was partially explained by plant diversity and vegetation structure. However, which vegetation parameters had a bigger influence on observed distribution patterns and how they differ between moth taxa was not further explored by the authors. Taking into account the differences in life history between geometrid and arctiine moths (such as host-plant preferences, chemical defenses, camouflage, flight capacity, among others), their responses to structural or floristic vegetation features could help us better explore the potential of predicting diversity and turnover rates of these groups in human-dominated landscapes.

### Study Questions

1. Are structural or floristic features superior predictors of small-scale gradients in moth species composition in relation to land-use intensity?
2. Are responses similar in the two moth groups, despite some major differences in prime life-history traits of these moth taxa?

### Justification

Conservation efforts are made more efficient and effective by understanding quantitative relationships in complex ecological systems. Therefore, isolating important variables such as the most vulnerable life stage of an endangered species, the most ecotoxic pollutants contaminating a wetland, or the least resilient taxon in a disturbed ecosystem is critical to making useful change. African oil palm plantations in the neotropics represent an immense challenge to the stability of tropical rainforest ecology. In particular, insects in and around these plantations are easily disturbed by the deforestation and establishment of the african oil palm monoculture. Their complex life cycles and trophic specificity are often ill-suited for large spatial-scale changes in canopy cover, plant species diversity, and vertical complexity. Within class Insecta, however, some taxa are more resilient than others. Geometridae and Arctiinae (Lepidoptera) share much of their ranges worldwide, but have very different life history strategies. We predict that modelling will reveal that vegetation variables will have drastically different effects on the success of these taxa. Geometridae larval fitness is largely derived from their highly effective mimicry of leaves and twigs. On the other hand, Arctiinae larvae are often conspicuous or aposomatic and have formidable spines or urticating hairs for defense against a wide variety of predators. The adults of these moth taxa have life histories differing in a similar way; Geometridae are poor fliers and mimic tree bark, while Arctiinae are strong fliers and mimic wasps or possess threatening coloration. Evidence suggests that... Establishing that superficially similar taxa have inherently different responses to disturbance is crucial for informing conservation policy not only in the case of Geometridae and Arctiinae, but in many other cryptic or non-charismatic taxa worldwide. 

### Data

* Moths
  + Species abundance matrix for both Arctiinae and Geometridae, per study site and date of collection.
  + Species abundance, richness, diversity and dominance for both Arctiinae and Geometridae, per study site and date of collection.

* Vegetation parameters
  + Tree species abundance matrix per study site
  + Plant species richness 
  + Vegetation density
  + Plant species diversity (Fisher's alpha index)
  + Understory density 
  + Understory complexity
  + Undergrowth cover
  + Vertical complexity
  + Canopy cover
  + Tree basal area

### Proposed methods

* Generation of Multiple Linear Regression and Redundancy Analysis models to relate moth diversity to floristic diversity and vegetation structure across habitats using PC's (from initial PCA) generated from vegetation structure and diversity data as predictor variables in the MLR and RA

* Utilize alpha diversity calculations from species data (from each geometrid and arctiine data sets). 

* Components of MLR models determined via a-priori approach/ from the calculated statistical significance of PC components for floristic and structural elements independently. 

* MLR Models can then be compared via AIC (Akaike's Information Criterion). 

* Simplified AIC methodologies could also be utilized- models of singular floristic or structural elements or combinations between the two could be chosen a-priori and the quality of that models could be assessed using either AIC/BIC or related methods.

* Data available on vegetation structure in a variety of site types includes vegetation density, understory density, understory complexity, undergrowth cover, vertical complexity, canopy cover, and tree basal area. Floristic features for vegetation includes plant species richness and plant species diversity. Site type (FI, FM, YSF, and OPP) could also be integrated into the models and tested for significance in explaining the diversity of the two groups.


Reminder: Add references
```{r}
setwd("C:/Users/PC/Documents/R/Moths_QuantReas")
library(corrplot)
Mothveg <- read.csv('Mothveg.csv')
PCorr <- cor(Mothveg,use="complete.obs", method = "pearson")
SCorr <- cor(Mothveg,use="complete.obs", method = "spearman")

corrplot(PCorr,method="square",order="hclust",type="upper",main="Pearson Correlation")
corrplot(SCorr,method="square",order="hclust",type="upper",main="Spearman Correlation")
```
We used the Pearson and Spearman methods to determine correlation between the vegetation parameters. We determined that a floristic model could safely include the following parameters since they lack strong correlations: plant species diversity, vegetation density, and a plant composition matrix. We also found that a structural model could include the following  parameters: understory complexity, canopy coverage, and vertical complexity.



## Calculating Fisher's alpha Diversity Index for Geometridae and Arctiinae

```{r}
G_matrix <- read.csv('Geo_site_matrix.csv')
G_fisher <- fisher.alpha(G_matrix) 
G_fisher <- as.data.frame(G_fisher)

A_matrix <- read.csv('Arc_site_matrix.csv')
A_fisher <- fisher.alpha(A_matrix) #Error: doesn't run even thought its the same code as for geometrids
A_fisher <- as.data.frame(A_fisher)

#export data to csv
write.table(G_fisher, file="G_div.csv",sep=",",row.names=F)
write.table(A_fisher, file="A_div.csv",sep=",",row.names=F)
```


# Extracting the NMDS axis coordinates for the plant species matrix, to used as proxy for plant species composition

```{r}
plants <- read.csv("Plant_matrix.csv")
sites <- read.csv("SiteCode.csv")
habitat <- read.csv("Habitat.csv")

install.packages("MASS")
library("MASS")

PlantsOrd <- metaMDS(plants,distance = "bray", k = 3,trymax=100)
PlantsOrd
plot(PlantsOrd)

cols <- c("red", "blue", "pink", "green")
plot(PlantsOrd, type = "n")
points(PlantsOrd, col = cols[habitat$Habitat], pch = 16)
legend("topright", legend=levels(habitat$Habitat), col=cols, pch = 16)

cols <- c("red", "blue", "pink", "green")
plot(PlantsOrd, type = "n")
points(PlantsOrd, col = cols[sites$Site.Code], pch = 16)
legend("topright", legend=levels(sites$Site.Code), col=cols, pch = 16)

stressplot(PlantsOrd)

################## ggplot ###################

install.packages("ggplot2")
install.packages("Rcpp")
library("ggplot2")
require("ggplot2")

set.seed(201)
PlantsOrd1 <- metaMDS(plants)
plot(PlantsOrd1$points, col = sites$Site.Code)
ordiellipse(PlantsOrd1, sites$Site.Code, display = "sites", kind = "sd", label = T)
NMDS = data.frame(MDS1 = PlantsOrd1$points[,1], MDS2 = PlantsOrd1$points[,2],group=sites$Site.Code)

#Extract NMDS axis scores
nms_axis <- scores(PlantsOrd, choices=c(1,2))
write.table(nms_axis, file="Plant_nms_axis.csv",sep=",",row.names=F)
```

